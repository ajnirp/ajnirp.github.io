+++
title = "Solving Project Euler #45"
date = 2025-11-14
+++

## Introduction

[Project Euler](https://projecteuler.net) is a repository of fantastic computational problems that require a modest to heavy degree of mathematical thinking. As someone who enjoys programming and math, I love Project Euler. In this post we'll discuss a solution to a fun problem of theirs that I solved the other day, [problem 45](https://projecteuler.net/problem=45).

But first, a disclaimer:

<div role="warning">
From the Project Euler <a href=https://projecteuler.net>FAQ</a>: "[...] the rule about sharing solutions outside of Project Euler does not apply to <b>the first one-hundred problems</b>, as long as any discussion clearly aims to instruct methods, not just provide answers, and does not directly threaten to undermine the enjoyment of solving later problems. Problems 1 to 100 provide a wealth of helpful introductory teaching material and if you are able to respect our requirements, then we give permission for those problems and their solutions to be discussed elsewhere."
</div>

Emphasis mine. With that noted, let's discuss the problem.

## Problem statement

Triangle, pentagonal, and hexagonal numbers are generated by the following formulae:

{% katex(block=true) %}
T_n = n(n + 1)/2 \\
P_n = n(3n - 1)/2 \\
H_n = n(2n - 1) \\
{% end %}

where {{ katex(body="n") }} is a positive integer. So, for example, {{ katex(body="T_1 = P_1 = H_1 = 1") }}.

It can be verified that {{ katex(body="T_{285} = P_{165} = H_{143} = 40755") }}.

<div role="highlight">Find the next triangle number that is also pentagonal and hexagonal.</div>

Feel free to try and solve this yourself in another tab. Maybe you'll end up with a different solution than mine, in which case I'd love to hear about it ðŸ™‚

## Sketching out a solution

We have two equations in three variables, and some very useful domain constraints. Let's say the {{ katex(body="t^{th}") }} triangular number equals the {{ katex(body="p^{th}") }} pentagonal number equals the {{ katex(body="h^{th}") }} hexagonal number. And so:

{% katex(block=true) %}
T_t = H_h \\
P_p = H_h
{% end %}

We also have some useful domain constraints. {{ katex(body="t, p, h") }} are positive integers, which gives us these inequalities

{% katex(block=true) %}
t \ge 0 \\
p \ge 0 \\
h \ge 0
{% end %}

Expand out the equations:

{% katex(block=true) %}
t(t + 1)/2 = h(2h - 1) \\
p(3p - 1)/2 = h(2h - 1)
{% end %}

### Expressing `t` in terms of `h`

Let's focus on the first one:

{% katex(block=true) %}
t(t + 1)/2 = h(2h - 1) \\
\implies t(t + 1) = 2h(2h - 1) \\
\implies t(t + 1) = (2h - 1)2h \\
\implies t(t + 1) = (2h - 1)((2h - 1) + 1) \\
\implies t(t + 1) = u(u + 1)
{% end %}

where {{ katex(body="u \coloneqq 2h - 1") }}. The only way for two integers {{ katex(body="u, t") }} to satisfy that last equation while both being positive is for them to be equal to each other, and so we get {{ katex(body="t = u = 2h - 1") }}.

We've turned one of our variables into a function of the other, {{ katex(body="t = 2h - 1") }}! Let's do the same for {{ katex(body="p") }}.

### Expressing `p` in terms of `h`

{% katex(block=true) %}
p(3p - 1)/2 = h(2h - 1) \\
\implies p(3p - 1) = 2h(2h - 1) \\
\implies 3p^2 - 3p + (2h - 4h^2) = 0 \\
{% end %}

The final step above was me expanding out all the brackets and pushing everything over to the left. I also kept the parens around the last two terms on the left because I wanted to make the equation look like â€” you guessed it â€” a quadratic equation in {{ katex(body="p" )}}.

Let's apply the quadratic formula:

{% katex(block=true) %}
p = \frac{-1 \pm \sqrt{1 - 4.3.(2h - 4h^2)}}{2.3} = \frac{-1 \pm \sqrt{1 + 12(4h^2 - 2h)}}{6}
{% end %}

Note that I flipped the order of the terms inside the parens around so I could get rid of the negative sign outside the parens.

There are two solutions here, but we can discard the one that looks like
{% katex(block=true) %}
\frac{-1 - \sqrt{stuff}}{6}
{% end %}

because it's negative! To see why, note that the denominator is positive and both terms in the numerator are negative.

And so we get a one-to-one mapping from {{ katex(body="h" )}} to {{ katex(body="p" )}}:

{% katex(block=true) %}
p = \frac{-1 + \sqrt{1 + 12(4h^2 - 2h)}}{6}
{% end %}

This is way messier than the earlier mapping {{ katex(body="t = 2h - 1" )}}. But now we have enough to write our solver program.

## Coding it up

Here's some Python code that implements our search for the next solution:

```python,linenos
from math import sqrt

def sqrt_discriminant(m):
    return sqrt(12*(4*m*m - 2*m) + 1)

def nth_triangle_num(n):
    return n*(n+1)//2

h = 144
while True:
    s = sqrt_discriminant(h)
    if int(s) == s:
        numerator = int(s) + 1
        if numerator % 6 == 0:
            t = 2*h - 1
            p = numerator // 6
            print(nth_triangle_num(t))
            break
    h += 1
```

We're doing a simple linear search starting from {{ katex(body="h = 144" )}}, because, as the problem requires, we're searching for the next solution after {{ katex(body="h = 143" )}}. Within our search, we ignore all values of {{ katex(body="h" )}} for which the expression

{% katex(block=true) %}
p = \frac{-1 + \sqrt{1 + 12(4h^2 - 2h)}}{6}
{% end %}

is not an integer. For it to be an integer:

* the numerator must be an integer
* ...and it must be divisible by {{ katex(body="6") }}.

For the numerator to be an integer, the quantity {{ katex(body="1 + 12(4h^2 - 2h)") }} must be a perfect square. That's what the `int(s) == s` check is for. The rest is pretty straightforward â€” once we find a value for {{ katex(body="h") }} that yields an integer value for {{ katex(body="p") }}, we find the corresponding value of {{ katex(body="t") }}, print the values and then break out of our otherwise-infinite `while` loop.

The above code spits out an answer almost immediately on my laptop.

An aside: it feels like overkill to use the Python standard library's `math.sqrt` function just to check if a number is a perfect square. As it turns out, we don't need to use it! You can always write an integer sqrt implementation that uses binary search to find the square root of a positive integer, rounded down to the nearest integer, and then check that squaring _that_ integer equals our original number. I leave this as an exercise to the reader.

## Conclusion

I hope you enjoyed this dissection of a not-terribly-difficult but nevertheless very enjoyable problem. Thank you for reading!

**P.S.** Hover to reveal the answer, if you're curious: {{ spoiler(body="the next triangle number that is also pentagonal and hexagonal is 1533776805") }}.